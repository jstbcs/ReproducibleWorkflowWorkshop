---
title: "In-class assignment"
author: "Michelle Donzallaz"
date: "22 March 2023"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("curl")
```

# Git and Rmarkdown 

## Get to know git

1. Make a new repository.
2. Clone it using RStudio to make a local repository.
3. Write a (short) README file for your test repository using Markdown formatting.
4. Add your unstaged files, commit the changes
5. Before you can push the changes to your repository, you need to set up PAT (personal access token) or SSH based authentication. This is part of the general set-up and does not need to be repeated often. There are several ways of doing this and you are of course free to choose your preferred method. I recommend (aka this is how I did it ;-)), you use PAT based authentication and follow steps 1-7 outlined [*here*](https://mgimond.github.io/Colby-summer-git-workshop-2021/authenticating-with-github.html). **After step 7**, copy the PAT and run the following command in R and follow the steps:

```{r, eval = FALSE}
credentials::set_github_pat("Your_token")
```

6. Now push your changes to your remote repository!

<img src="slides/pics/do.png" width="220" align="right">

```{r, out.width = '25%', fig.align = 'left', echo = FALSE}
knitr::include_graphics("slides/pics/do.png")
```


## Branch out

Now it is time to make a development branch. You can also do this within RStudio but let's try out the terminal!

5. Open the terminal in RStudio. Make sure you are in the right directory. Type:

```{r eval = F}
git checkout -b dev
```

This moves you to the new branch called dev. You can also see it in the git interface in RStudio (typically top right panel).

Now you are ready to go to work!

<img src="slides/pics/do.png" width="220" align="right">

## Interact with git repositories and use rmarkdown

Now it is time to put your new knowledge on Rmarkdown and git to good use. 

6. Open a new Rmd file and save it in the git repository.

We will now use a data set from another repo for a simple analysis. This [*repository*](https://github.com/PerceptionCognitionLab/data0/tree/master/contexteffects/FlankerStroopSimon) contains data from several cognitive tasks. The [*R file*](https://raw.githubusercontent.com/PerceptionCognitionLab/data0/master/contexteffects/FlankerStroopSimon/cleaning.R) in the repo loads and cleans the data.

7. Source the R-file from github directly. *Hint:* [*Google is your best friend*](https://stackoverflow.com/questions/35720660/how-to-use-an-r-script-from-github)

You should now have the data set `stroop` loaded in R.

```{r echo = F, message = F}
devtools::source_url("https://raw.githubusercontent.com/PerceptionCognitionLab/data0/master/contexteffects/FlankerStroopSimon/cleaning.R")

head(stroop)
```

We want to analyze the response time (`rt`) as a function of condition (`cond`).

8. Conduct a paired t-test for the stroop task data.

*Hint 1:* You first need to aggregate the data.

*Hint 2:* This should be the results

```{r, echo = F, message=F}
library(dplyr)

stroop_agg <- stroop %>%
  group_by(ID, cond) %>%
  summarize(mean_rt = mean(rt))

t.test(mean_rt ~ cond, data = stroop_agg, paired = T)
```

9. Make sure to knit your Rmarkdown document either to html or pdf.

<img src="slides/pics/do.png" width="220" align="right">

## Back to git

10. Now add, commit, and push both the rmd file and the result file.

You can either use the RStudio git interface or the terminal. In the terminal, type:

```{r eval = F}
git add myfile.Rmd myfile.html
git commit -am "my commit message"
git push --set-upstream origin dev
```

11. And then merge the `dev` branch into `master`. You can do it in your remote repository on the github webpage. Or you can use the terminal for this:

```{r eval = F}
git checkout master
git merge dev --no-ff -m "merge dev"
git push
```

<img src="slides/pics/do.png" width="220" align="right">